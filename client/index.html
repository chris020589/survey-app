<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>å•å·å¡«å¯«</title>
</head>
<body>
  <h1 id="surveyTitle">å•å·æ¨™é¡Œ</h1>
  <p id="surveyDesc">å•å·æè¿°</p>

  <form id="surveyForm"></form>

  <button onclick="submitSurvey()">æäº¤</button>

  <script>
    let surveyId = ''; // å•å·ID
    let surveyData = {}; // å•å·å®Œæ•´è³‡æ–™

    // ğŸ”¥ 1. å–å¾—å•å·è³‡æ–™
    async function loadSurvey() {
      // ğŸŸ¡ æ›æˆä½ è³‡æ–™åº«è£¡çš„å•å·ID
      surveyId = 'æ”¾ä½ çš„å•å·ID';
      let res = await fetch(`http://localhost:5000/api/surveys/${surveyId}`);
      surveyData = await res.json();

      document.getElementById('surveyTitle').innerText = surveyData.title;
      document.getElementById('surveyDesc').innerText = surveyData.description;

      let form = document.getElementById('surveyForm');
      form.innerHTML = '';

      // ğŸ”„ 2. å‹•æ…‹ç”¢ç”Ÿé¡Œç›®
      surveyData.questions.forEach((q, index) => {
        let qDiv = document.createElement('div');
        qDiv.innerHTML = `<p>${index + 1}. ${q.questionText}</p>`;

        if (q.type === 'single') {
          q.options.forEach(opt => {
            qDiv.innerHTML += `<label><input type="radio" name="q${index}" value="${opt}"> ${opt}</label><br>`;
          });
        } else if (q.type === 'multiple') {
          q.options.forEach(opt => {
            qDiv.innerHTML += `<label><input type="checkbox" name="q${index}" value="${opt}"> ${opt}</label><br>`;
          });
        } else if (q.type === 'text') {
          qDiv.innerHTML += `<textarea name="q${index}"></textarea>`;
        }

        form.appendChild(qDiv);
      });
    }

    loadSurvey();

    // ğŸš€ 3. æäº¤å•å·
    async function submitSurvey() {
      let answers = [];

      surveyData.questions.forEach((q, index) => {
        if (q.type === 'single') {
          let selected = document.querySelector(`input[name="q${index}"]:checked`);
          answers.push(selected ? selected.value : '');
        } else if (q.type === 'multiple') {
          let selected = Array.from(document.querySelectorAll(`input[name="q${index}"]:checked`));
          answers.push(selected.map(x => x.value));
        } else if (q.type === 'text') {
          let text = document.querySelector(`textarea[name="q${index}"]`).value;
          answers.push(text);
        }
      });

      let res = await fetch(`http://localhost:5000/api/surveys/${surveyId}/answers`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ answers })
      });

      let data = await res.json();
      alert('å•å·æäº¤æˆåŠŸï¼');
    }
  </script>
</body>
</html>
